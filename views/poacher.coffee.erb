# Ruby rand
rand: (n) ->
  Math.floor(Math.random()*n)

Array.prototype.pick: ->
  this[rand(@length)]

window.Art: Art: {
  width: 960,
  height: 1280,
  visibleWidth: 700

  colors: ['#FFFFFF', '#9900CC', '#0066CC', '#FFFF00', '#33CC99', '#FF6633']

  works: []
  add: (fn) ->
    @works.push fn

  shift: ->
    $(@paper.canvas).css('marginTop', - (@height - @visibleHeight)*0.5)

  clear: -> @paper.clear()

  draw: ->
    @bg: @paper.rect(0,0,@width,@height).attr({
      fill: @colors.pick()
      stroke: 'none'
      opacity: Math.random()
    }) if rand(2) == 0
    focus: {
      x: (@width-@visibleWidth)*0.5 + rand(@visibleWidth)
      y: (@height-@visibleHeight)*0.5 + rand(@visibleHeight)
    }
    for i in [0...4+rand(4)]
      @works[rand(@works.length)].call(@paper, @colors.pick(), focus)
}

# Forces evaluation
for tag in document.getElementsByTagName('script') when tag.type is 'text/x-artwork'
  eval(CoffeeScript.compile(tag.innerHTML))

$(document).ready ->
  frame: $('#frame')
  Art.visibleHeight: frame.height()
  console.log Art.visibleHeight
  Art.paper: Raphael 'art', Art.width, Art.height
  Art.shift()
  Art.draw()

  frame.find('.reload').click ->
    Art.clear()
    Art.draw()
    false

  $('#buy').click ->
    $.ajax {
      type: 'POST'
      url: '/tee'
      data: $('#art')[0].innerHTML.toString()
      contentType: 'image/svg+xml'
      processData: false
      format: 'json'
      success: (data) ->
        console.log data
    }


